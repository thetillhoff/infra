services:
  fileserver:
    build:
      context: .
      dockerfile: Dockerfile
    restart: always
    logging:
      driver: "json-file"
      options:
        max-file: "10"
        max-size: "2m"
    ports:
      - "445:445"
    volumes:
      # Mount host system user database files for authentication
      - /etc/passwd:/etc/passwd:ro
      - /etc/shadow:/etc/shadow:ro
      - /etc/group:/etc/group:ro
      # Mount encrypted users configuration file (USER:PASSWORD format)
      # This file contains Samba user credentials and is encrypted with SOPS
      # Format: username:password (one per line, comments start with #)
      - /mnt/cold/users.txt:/mnt/config/users.txt:ro
      # Mount data volumes into /mnt/<username>
      # Configured statically in the smb.conf file
      # - /mnt/cold/public:/mnt/public:rw

      # Configured dynamically in the start.sh script
      - /mnt/cold/public:/mnt/public:rw
      - /mnt/cold/backup:/mnt/backup:rw
      - /mnt/cold/backup-blackstone:/mnt/backup-blackstone:rw
      - /mnt/cold/backup-macbook-superluminar:/mnt/backup-macbook-superluminar:rw
