# Sample configuration file for the Samba suite for Debian GNU/Linux.
#
#
# This is the main Samba configuration file. You should read the
# smb.conf(5) manual page in order to understand the options listed
# here. Samba has a huge number of configurable options most of which
# are not shown in this example
#
# Some options that are often worth tuning have been included as
# commented-out examples in this file.
#  - When such options are commented with ";", the proposed setting
#    differs from the default Samba behaviour
#  - When commented with "#", the proposed setting is the default
#    behaviour of Samba but the option is considered important
#    enough to be mentioned here
#
# NOTE: Whenever you modify this file you should run the command
# "testparm" to check that you have not made any basic syntactic
# errors.

#======================= Global Settings =======================

[global]

## Browsing/Identification ###

# Change this to the workgroup/NT-domain name your Samba server will part of
# This is the workgroup that Windows clients will see the server in
   workgroup = WORKGROUP

# server string is the equivalent of the NT Description field
# This appears in Windows Network Neighborhood/File Explorer
   server string = %h server (Samba, Ubuntu)

#### Networking ####

# The specific set of interfaces / networks to bind to
# This can be either the interface name or an IP address/netmask;
# interface names are normally preferred
;   interfaces = 127.0.0.0/8 eth0

# Only bind to the named interfaces and/or networks; you must use the
# 'interfaces' option above to use this.
# It is recommended that you enable this feature if your Samba machine is
# not protected by a firewall or is a firewall itself.  However, this
# option cannot handle dynamic or non-broadcast interfaces correctly.
;   bind interfaces only = yes


# NetBIOS Disabled Configuration
# Completely disable NetBIOS for modern SMB-only operation
   disable netbios = yes
   dns proxy = no
   hostname lookups = no

#### Debugging/Accounting ####

# This tells Samba to use a separate log file for each machine that connects
# %m is replaced with the client machine name (e.g., log.WORKSTATION1)
   log file = /var/log/samba/log.%m

# Cap the size of the individual log files (in KiB).
# When this size is reached, the log is rotated
   max log size = 1000

# We want Samba to only log to /var/log/samba/log.{smbd,nmbd}.
# Append syslog@1 if you want important messages to be sent to syslog too.
# 'file' means log only to files, not to syslog
   logging = file

# Do something sensible when Samba crashes: mail the admin a backtrace
# %d is replaced with the debug level
   panic action = /usr/share/samba/panic-action %d


####### Authentication #######

# Server role. Defines in which mode Samba will operate. Possible
# values are "standalone server", "member server", "classic primary
# domain controller", "classic backup domain controller", "active
# directory domain controller".
#
# Most people will want "standalone server" or "member server".
# Running as "active directory domain controller" will require first
# running "samba-tool domain provision" to wipe databases and create a
# new domain.
# "standalone server" = simple file server, not part of a domain
   server role = standalone server

# Authentication Method: Host System Integration
# This configuration uses the host system's user database (/etc/passwd, /etc/shadow, /etc/group)
# Users authenticate with their host system username and password
# No separate Samba password management needed - uses system passwords directly

# Use system authentication - Samba will authenticate against /etc/passwd and /etc/shadow
# This means users can authenticate with their system password without separate Samba setup
   security = user
   passdb backend = smbpasswd

# When enabled, Samba will respect PAM account restrictions
# PAM (Pluggable Authentication Modules) can restrict access based on time, location, etc.
   obey pam restrictions = yes

# This boolean parameter controls whether Samba attempts to sync the Unix
# password with the SMB password when the encrypted SMB password in the
# passdb is changed.
# When a user changes their SMB password, also update their Unix password
# Set to 'no' when using host system authentication to avoid conflicts
   unix password sync = no

# For Unix password sync to work on a Debian GNU/Linux system, the following
# parameters must be set (thanks to Ian Kahan <<kahan@informatik.tu-muenchen.de> for
# sending the correct chat script for the passwd program in Debian Sarge).
# %u is replaced with the username
   passwd program = /usr/bin/passwd %u
   passwd chat = *Enter\snew\s*\spassword:* %n\n *Retype\snew\s*\spassword:* %n\n *password\supdated\ssuccessfully* .

# This boolean controls whether PAM will be used for password changes
# when requested by an SMB client instead of the program listed in
# 'passwd program'. The default is 'no'.
# PAM can provide additional security features during password changes
   pam password change = yes

# This option controls how unsuccessful authentication attempts are mapped
# to anonymous connections
# "bad user" = if user doesn't exist or password is wrong, treat as guest
   map to guest = bad user

# Guest account - the Unix user account used for guest connections
# "nobody" is a standard Unix user with minimal privileges
   guest account = nobody

#======================= Share Definitions =======================

# Un-comment the following (and tweak the other settings below to suit)
# to enable the default home directory shares. This will share each
# user's home directory as \\server\username
;[homes]
;   comment = Home Directories
;   browseable = no

# By default, the home directories are exported read-only. Change the
# next parameter to 'no' if you want to be able to write to them.
;   read only = yes

# File creation mask is set to 0700 for security reasons. If you want to
# create files with group=rw permissions, set next parameter to 0775.
;   create mask = 0700

# Directory creation mask is set to 0700 for security reasons. If you want to
# create dirs. with group=rw permissions, set next parameter to 0775.
;   directory mask = 0700

# By default, \\server\username shares can be connected to by anyone
# with access to the samba server.
# Un-comment the following parameter to make sure that only "username"
# can connect to \\server\username
# This might need tweaking when using external authentication schemes
;   valid users = %S


#======================= Security Settings =======================

## Protocol Security Settings

# Enforce highest SMB3 protocol version for maximum security
# SMB3_11 is the latest and most secure version
# This prevents older, less secure protocols from being used
  server min protocol = SMB3_11
  server max protocol = SMB3_11
  client min protocol = SMB3_11
  client max protocol = SMB3_11

## SMB Encryption Settings (commented out - can be enabled for extra security)
# Enforce SMB encryption - all connections must be encrypted
# Note: This may cause compatibility issues with some older clients
#  server smb encrypt = required    # Server requires encryption
#  client smb encrypt = required    # Client requires encryption  
#  smb encrypt = required           # Both server and client require encryption

## Authentication Security

# Disable NTLMv1 authentication (weak and vulnerable)
# Only allow NTLMv2 and Kerberos authentication
  ntlm auth = ntlmv2-only

## SMB Signing (prevents man-in-the-middle attacks)
# Windows 11 compatible signing settings
# 'auto' allows negotiation - Windows 11 will use signing when supported
# 'mandatory' can cause connection issues with some Windows 11 clients
  # Server negotiates signing with clients
  server signing = mandatory
  # Client negotiates signing with server
  client signing = mandatory

## Anonymous Access Control
# Restrict anonymous access to IPC$ share (used for share enumeration)
# The IPC$ share is used for browsing available shares before authentication
# Without anonymous access, public shares can still be accessed directly,
# but the share overview cannot be accessed without credentials
# Values: 0=allow, 1=restrict SAMR, 2=restrict SAMR+IPC$
#  restrict anonymous = 2

#======================= Share Definitions =======================

# The [public] share was replaced by a user-specific share for a user named `public` (via users.txt).
# That's because Windows 11 (and probably earlier versions as well) disabllow guest authentication by default.
# This can be adjusted via GPO, but it also disables encryption and signing.

# [public]
#    # Public share - accessible without credentials - user `chown -R nobody:nogroup /mnt/public && chmod -R 777 /mnt/public` to set permissions if they are broken
#    # This is the path inside the container where files are stored
#    path = /mnt/public
   
#    # Windows 11 compatible guest access configuration
#    # Allow guest access but don't force it - let Windows negotiate
#    guest ok = yes
#    guest only = no
   
#    # Allow this share to be visible in network browsing
#    browsable = yes
   
#    # Allow write access to the share
#    writeable = yes
   
#    # File creation mask: permissions for new files (0666 = rw-rw-rw-)
#    # This allows all users to read and write files
#    create mask = 0666
   
#    # Directory creation mask: permissions for new directories (0777 = rwxrwxrwx)
#    # This allows all users to create, read, write, and execute in directories
#    directory mask = 0777
   
#    # Windows 11 compatibility settings
#    # Force case sensitivity off for Windows compatibility
#    case sensitive = no
   
#    # Additional Windows 11 guest access settings
#    # Force guest account to be used for anonymous access
#    force user = nobody
#    force group = nogroup
